##########################################################################################
# Data Model Glossary of Terms
##########################################################################################

# Make sure 'id' is unique within the set of terms, and try
# to keep terms sorted by 'id' for easier maintenance

terms:
  - id: CF
    name: Column Family
    info: The portion of the Accumulo key representing the column family

  - id: CQ
    name: Column Qualifier
    info: The portion of the Accumulo key representing the column qualifier

  - id: D
    name: Document Column Family
    info: Column family for document content. Literal string with the value of ' d '

  - id: DC
    name: Document Content
    info: Raw document content for the ' d ' column entry. Gzip compressed, then base64 encoded

  - id: DO
    name: Data Object
    info: |
       A real-life object for which field names and field values can be derived. Typically, use of this term will
       denote an object stored within DataWave's primary data table

  - id: DT
    name: Data Type
    info: An identifier that describes some category or facet of the Data Objects associated with it

  - id: DTN
    name: Date Type Name
    info: |
       A user-specified identifier used as the CF within the Date Index table. E.g., this value may be used as a query
       parameter to indicate to the Query API that it should leverage the Date Index for date range filtering rather than
       the default, shard-based date range

  - id: DVN
    name: Document View Name
    info: Identifier within the ' d ' column qualifier, which categorizes the content

  - id: EAV
    name: Edge Attribute Vector
    info: Three optional, user-supplied attributes which can be appended to the edge key's CQ. These attributes are typically delimited by ' / '
    
  - id: "EAV[0]"
    name: "EAV Element &#x23;1"
    info: |
      The first element of the Edge Attribute Vector (EAV). Typically used to denote a subcategory or facet of the given Edge Type (ETYPE) value.
      This element is required (typically set in configuration), whereas the remaining EAV elements are optional

  - id: "ENFV<sub>1</sub>"
    name: Source Edge Vertex (NFV)
    info: A Field Value processed by a Normalizer that represents the SOURCE vertex in a unidirectional edge key

  - id: "ENFV<sub>2</sub>"
    name: Sink Edge Vertex (NFV)
    info: A Field Value processed by a Normalizer that represents the SINK vertex in a unidirectional edge key

  - id: "EPB<sub>0</sub>"
    name: Edge Metadata Protocol Buffer
    info: Protocol Buffer denoting the Data Object (DO) field mappings that were used in the creation of one or more Edge Table keys

  - id: "EPB<sub>1</sub>"
    name: Edge Table Protocol Buffer
    info: Protocol Buffer containing one LONG which is the count of the edge for the day and an INT32 bitmask for hour of the day

  - id: "EPB<sub>2</sub>"
    name: Edge STATS&#8209;ACTIVITY Protocol Buffer
    info: Protocol Buffer containing one LONG[24] which is the count per hour for each our of the day

  - id: "EPB<sub>3</sub>"
    name: Edge STATS&#8209;DURATION Protocol Buffer
    info: "Protocol Buffer containing histogram as LONG[7]: [ <10 sec, 10-30 sec, 30-60 sec, 1-5 min, 5-10 min, 10-30 min, >30 min ]"

  - id: EREL
    name: Edge Relationship
    info: Two user-provided string values delimited by ' - ' used as part of the edge key CF, for describing the relationship between the respective SOURCE and SINK vertices

  - id: ETYPE
    name: Edge Type
    info: User-provided string value used as part of the edge key CF, for categorizing edges

  - id: FI
    name: Field Index Column Family
    info: A column family prefix for field index keys. Literal string with the value of ' fi '

  - id: FN
    name: Field Name
    info: The name of a field in a Data Object

  - id: FV
    name: Field Value
    info: The raw value associated with a particular Field Name

  - id: N
    name: Normalizer
    info: An object that transforms data so that it can be sorted lexicographically

  - id: NB
    name: Null Byte Character
    info: A character with the hex value of \x00, used as a delimiter

  - id: NCN
    name: Normalizer Class Name
    info: The fully-qualified name of the Normalizer (N) Java class used for indexing purposes

  - id: NFN
    name: Normalized Field Name
    info: A Field Name (FN) transformed to be compatible with the query code

  - id: NFV
    name: Normalized Field Value
    info: A Field Value (FV) that has been processed/transformed by a Normalizer (N)

  - id: NT
    name: Normalized Term
    info: An individual term within a document transformed to be compatible with the query code

  - id: "NULL"
    name: Null Value
    info: No value is assigned for keys of this type

  - id: PB
    name: Protocol Buffer
    info: Google Protocol Buffer

  - id: RNFV
    name: Reversed Normalized Field Value
    info: A Field Value (FV) that has been processed/transformed by a Normalizer (N) and then reversed

  - id: SHARD
    name: Shard ID
    info: The partition identifier in the form of YYYYMMDD_N, where N is an integer denoting a specific sub-partition within the given day

  - id: TF
    name: Term Frequency Column Family
    info: Column family for term frequency keys. Literal string with the value of ' tf '

  - id: TFPB
    name: Term Frequency Protocol Buffer
    info: Google Protocol Buffer containing a list of word offsets for the term in the document

  - id: UID
    name: Unique Identifier
    info: |
          An internal identifier generated for the Data Object that is typically a hash of the raw source data.
          Guaranteed to be deterministic and unique within a given partition and Data Type

  - id: ULPB
    name: Uid.List Protocol Buffer
    info: A protocol buffer object that contains the number of occurrences of the field name/value pair, along with a bounded list of UIDs

  - id: VERT
    name: Vertex
    info: A single node within a graph


##########################################################################################
# Table Schema Definitions
##########################################################################################

tables:
  - id: PDT
    name: Primary Data Table
    info: Accumulo table where Data Objects are stored
    entries:
    - row: SHARD
      cf: DT + NB + UID
      cq: NFN + NB + FV
      val: "NULL"
      purpose: Represents a name/value pair for a given field (NFN) within the Data Object (DO)
      example: "20240101_6&nbsp;&nbsp;cars&#92;x00uid.abc.123:DESCRIPTION&#92;x001990&nbsp;Ford&nbsp;Mustang&nbsp;(Red)
                20240101_6&nbsp;&nbsp;cars&#92;x00uid.abc.123:MAKE&#92;x00Ford
                20240101_6&nbsp;&nbsp;cars&#92;x00uid.abc.123:MODEL&#92;x00Mustang
                20240101_6&nbsp;&nbsp;cars&#92;x00uid.abc.123:YEAR&#92;x001990"

    - row: SHARD
      cf: "'fi' + NB + NFN"
      cq: NFV + NB + DT + NB + UID
      val: "NULL"
      purpose: The <b>fi</b> (field index) column provides an in-partition index of field names and associated values for Data Objects that exist within the given shard
      example: "20240101_6&nbsp;&nbsp;fi&#92;x00MAKE:ford&#92;x00cars&#92;x00uid.abc.123
                20240101_6&nbsp;&nbsp;fi&#92;x00MODEL:mustang&#92;x00cars&#92;x00uid.abc.123"

    - row: SHARD
      cf: "'d'"
      cq: DT + NB + UID + NB + DVN
      val: DC
      purpose: (Optional) The <b>d</b> (document) column provides a named view of raw content, typically the raw source input that generated the Data Object
      example: "20240101_6&nbsp;&nbsp;d:cars&#92;x00uid.abc.123&#92;x00JSON&nbsp;&nbsp;[Base64&nbsp;encoded,&nbsp;gzipped&nbsp;json]"

    - row: SHARD
      cf: "'tf'"
      cq: DT + NB + UID + NT + NFN
      val: TFPB
      purpose: |
               (Optional) The <b>tf</b> (term frequency) column enables phrase queries by mapping a Data Object's
               tokenized terms to the positions (word offsets) of those terms within the source document 
      example: "20240101_6&nbsp;&nbsp;tf:cars&#92;x00uid.abc.123&#92;x001990&#92;x00DESCRIPTION&nbsp;&nbsp;[Protobuf&nbsp;of&nbsp;'1990'&nbsp;offsets]
                20240101_6&nbsp;&nbsp;tf:cars&#92;x00uid.abc.123&#92;x00ford&#92;x00DESCRIPTION&nbsp;&nbsp;[Protobuf&nbsp;of&nbsp;'ford'&nbsp;offsets]
                20240101_6&nbsp;&nbsp;tf:cars&#92;x00uid.abc.123&#92;x00mustang&#92;x00DESCRIPTION&nbsp;&nbsp;[Protobuf&nbsp;of&nbsp;'mustang'&nbsp;offsets]
                20240101_6&nbsp;&nbsp;tf:cars&#92;x00uid.abc.123&#92;x00red&#92;x00DESCRIPTION&nbsp;&nbsp;[Protobuf&nbsp;of&nbsp;'red'&nbsp;offsets]"

  - id: GFIDX
    name: Global Forward Index Table
    info: Index table used to map map field/value pairs to partitions (shards) within the Primary Data Table (PDT) where representative Data Objects may be found
    entries:
    - row: NFV
      cf: NFN
      cq: SHARD + NB + DT
      val: ULPB
      purpose: Maps the NFV:NFN pair to a given shard partition within the Primary Data Table (PDT), and optionally to a bounded list of Data Object UIDs within that partition
      example: "ford&nbsp;&nbsp;MAKE:20240101_6&#92;x00cars&nbsp;[Protobuf&nbsp;list&nbsp;of&nbsp;uid's&nbsp;including&nbsp;'uid.abc.123']
                mustang&nbsp;&nbsp;MODEL:20240101_6&#92;x00cars&nbsp;[Protobuf&nbsp;list&nbsp;of&nbsp;uid's&nbsp;including&nbsp;'uid.abc.123']"

  - id: GRIDX
    name: Global Reverse Index Table
    info: Index table used to map field/value pairs to partitions within the Primary Data Table (PDT) where representative Data Objects may be found
    entries:
    - row: RNFV
      cf: NFN
      cq: SHARD + NB + DT
      val: ULPB
      purpose: Maps the RNFV:NFN pair to a given shard partition within the Primary Data Table (PDT), and optionally to a bounded list of Data Object UIDs within that partition
      example: "drof&nbsp;&nbsp;MAKE:20240101_6&#92;x00cars&nbsp;[Protobuf&nbsp;list&nbsp;of&nbsp;uid's&nbsp;including&nbsp;'uid.abc.123']
                gnatsum&nbsp;&nbsp;MODEL:20240101_6&#92;x00cars&nbsp;[Protobuf&nbsp;list&nbsp;of&nbsp;uid's&nbsp;including&nbsp;'uid.abc.123']"

  - id: DDT
    name: Data Dictionary Table
    info: Contains information about data stored in other DataWave tables
    entries:
    - row: NFN
      cf: e
      cq: DT
      val: "NULL"
      purpose: "The <b>e</b> column family denotes that NFN is a field that exists within objects of the given Data Type (DT) within the Primary Data Table (PDT). <b>Note</b>:
                The absence of an <b>e</b> entry for a given NFN and the presence of <b>i</b> and/or <b>ri</b> entries for the NFN denotes that it is an <em>index-only</em> field,
                meaning that no such field exists within the PDT's Data Objects for the given DT"
      example: "DESCRIPTION&nbsp;&nbsp;e:cars
                MAKE&nbsp;&nbsp;&nbsp;e:cars
                MODEL&nbsp;&nbsp;&nbsp;e:cars"

    - row: NFN
      cf: i
      cq: "DT + NB + 'YYYYMMDD'"
      val: Integer Count
      purpose: "The <b>i</b> column family denotes that NFN exists in both the Global Forward Index (GFIDX) table and in the Primary Data Table's (PDT) <b>fi</b> column.
                The value denotes that 'Integer Count' instances of the NFN exist for the given date. <b>Note</b>: The absence of an <b>e</b> entry for a given NFN and
                the presence of <b>i</b> and/or <b>ri</b> entries for the NFN denotes that it is an <em>index-only</em> field, meaning that no such field exists
                within the PDT's Data Objects for the given DT"
      example: "MAKE&nbsp;&nbsp;i:cars&#92;x0020240101&nbsp;&nbsp;&#92;x01
                MAKE&nbsp;&nbsp;i:cars&#92;x0020240102&nbsp;&nbsp;&#92;x0E
                MODEL&nbsp;&nbsp;i:cars&#92;x0020240101&nbsp;&nbsp;&#92;x01
                MODEL&nbsp;&nbsp;i:cars&#92;x0020240102&nbsp;&nbsp;&#92;x0E"

    - row: NFN
      cf: ri
      cq: "DT + NB + 'YYYYMMDD'"
      val: Integer Count
      purpose: "The <b>ri</b> column family denotes that NFN exists in the Global Reverse Index (GRIDX) table, and the value denotes that 'Integer Count' instances of the NFN exist for the given date"
      example: "MODEL&nbsp;&nbsp;ri:cars&#92;x0020240101&nbsp;&nbsp;&#92;x01
                MODEL&nbsp;&nbsp;ri:cars&#92;x0020240102&nbsp;&nbsp;&#92;x0E"

    - row: NFN
      cf: f
      cq: "DT + NB + 'YYYYMMDD'"
      val: Integer Count
      purpose: "Similar to the <b>i</b> column, the <b>f</b> (frequency) column family conveys the 'Integer Count' times that instances of NFN were seen on the given date. These entries are recorded for non-indexed fields as well"
      example: "MAKE&nbsp;&nbsp;f:cars&#92;x0020240101&nbsp;&nbsp;&#92;x01
                MODEL&nbsp;&nbsp;f:cars&#92;x0020240101&nbsp;&nbsp;&#92;x01
                NON_INDEXED_FIELD&nbsp;&nbsp;f:cars&#92;x0020240101&nbsp;&nbsp;&#92;x01"
      
    - row: NFN
      cf: t
      cq: DT + NB + NCN
      val: "NULL"
      purpose: "The <b>t</b> (type) column denotes that values of the given field are normalized for indexing purposes using the specified Java class"
      example: "MAKE&nbsp;&nbsp;t:cars&#92;x00datawave.data.type.LcNoDiacriticsType
                YEAR&nbsp;&nbsp;t:cars&#92;x00datawave.data.type.NumberType"

    - row: NFN
      cf: desc
      cq: DT
      val: Text Description
      purpose: "The <b>desc</b> column family may be used to supply a <b>text description</b> of the NFN within type DT"
      example: "MAKE&nbsp;&nbsp;desc:cars&nbsp;Denotes&nbsp;the&nbsp;car's&nbsp;make/manufacturer&nbsp;name
                MODEL&nbsp;&nbsp;desc:cars&nbsp;Denotes&nbsp;the&nbsp;car's&nbsp;model&nbsp;name"
      
    - row: NFN
      cf: tf
      cq: DT
      val: "NULL"
      purpose: "The <b>tf</b> column family denotes that NFN is enabled for phrase queries, i.e., that it has <b>tf</b> (term frequency) column entries in the Primary Data Table (PDT)"
      example: "DESCRIPTION&nbsp;&nbsp;tf:cars"

    - row: "ETYPE + '/' + EREL"
      cf: edge
      cq: "EAV[0]"
      val: "EPB<sub>0</sub>"
      purpose: |
         The <b>edge</b> column family denotes that one or more Edge Table keys were formed using the given Row and CQ
         identifiers and were derived from field names in the Primary Data Table (PDT) that are given in the Protocol Buffer value. 
         These dictionary entries allow an Edge Table key to be mapped back to the source Data Object from which it
         was derived (e.g., via the <em>EdgeEventQuery</em> query logic)
      example: "CARS/MODEL&#8209;MAKE&nbsp;&nbsp;edge:SALES&nbsp;&nbsp;[Protobuf&nbsp;containing&nbsp;field&nbsp;name&nbsp;mapping]
                CARS/MODEL&#8209;YEAR&nbsp;&nbsp;edge:SALES&nbsp;&nbsp;[Protobuf&nbsp;containing&nbsp;field&nbsp;name&nbsp;mapping]"

  - id: EDGE
    name: Edge Table
    info: Accumulo table where edge keys are stored, with each key consisting of a pair of Normalized Field Value vertices and other attributes
    entries:
    - row: "ENFV<sub>1</sub> + NB + ENFV<sub>2</sub>"
      cf: ETYPE + ' / ' + EREL
      cq: "'YYYYMMDD' + ' / ' + EAV"
      val: "EPB<sub>1</sub>"
      purpose: |
               A unidirectional pair of vertices that expresses some relationship between a pair of Field Values originating from a Data Object, where
               the CQ and value may contain additional metadata about the related activity
      example: "mustang&#92;x00ford&nbsp;&nbsp;CARS/MODEL&#8209;MAKE:20240101/SALES/RegionA/Dealership1&nbsp;&nbsp;[Protobuf&nbsp;histogram&nbsp;object]
                mustang&#92;x001990&nbsp;&nbsp;CARS/MODEL&#8209;YEAR:20240101/SALES/RegionA/Dealership1&nbsp;&nbsp;[Protobuf&nbsp;histogram&nbsp;object]"

    - row: "ENFV<sub>1</sub>"
      cf: "'STATS' + NB + 'ACTIVITY' + ETYPE"
      cq: YYYYMMDD + NB + EAV
      val: "EPB<sub>2</sub>"
      purpose: "Provides activity stats for ENFV<sub>1</sub> for the given day"
      example: ""

    - row: "ENFV<sub>1</sub>"
      cf: "'STATS' + NB + 'DURATION' + ETYPE"
      cq: YYYYMMDD + NB + EAV
      val: "EPB<sub>3</sub>"
      purpose: "Provides duration stats for ENFV<sub>1</sub> for the given day"
      example: ""

  - id: DIDX
    name: Date Index Table
    info: Accumulo table that is used to map arbitrary date fields and their values to partitions within the Primary Data Table (PDT) where the corresponding Data Objects may be found
    entries:
    - row: "YYYYMMDD<sub>1</sub>"
      cf: DTN
      cq: "YYYYMMDD<sub>2</sub> + NB + DT + NB + NFN"
      val: BitSet denoting the date's presence within specific shard partitions. E.g., bit 0 is YYYYMMDD_0, and so on
      purpose: "Maps the date field (given by NFN) and its value (given by YYYYMMDD<sub>1</sub>) to the SHARD partition(s) specified by the YYYYMMDD<sub>2</sub> and BitSet values"
      example: ""

  - id: LDT
    name: Load Dates Table
    info: Stores information about which field names were loaded into which tables on a given date
    entries:
    - row: NFN
      cf: "'FIELD_NAME' + NB + Table Name"
      cq: YYYYMMDD + NB + DT
      val: Long integer encoded via Accumulo SummingCombiner (VARLEN)
      purpose: Denotes that NFN from the given DT was loaded into the specified table on the given date
      example: ""

  - id: QMT
    name: Query Metrics Tables
    info: |
       Set of four tables that mirror the schemas defined by PDT, GFIDX, GRIDX, and DDT respectively, but store information
       related exclusively to user queries. Rather than create redundant table layouts for these four tables, here we'll
       simply describe the normalized field name (NFN) and field value (FV) entries that comprise the query metrics data
       model itself
    entries:
    - nfn: AUTHORIZATIONS
      fv: User-specified list of Accumulo auths

    - nfn: BEGIN_DATE
      fv: User-specified date range start value

    - nfn: END_DATE
      fv: User-specified date range end value

    - nfn: PARAMETERS
      fv: User-specified query parameters

    - nfn: QUERY
      fv: User-specified query expression

    - nfn: QUERY_LOGIC
      fv: User-specified query logic name

    - nfn: QUERY_NAME
      fv: User-specified name assigned to the query

    - nfn: CREATE_DATE
      fv: Query creation date/time YYYYMMDD hhmmss

    - nfn: DOC_RANGES
      fv: Integer count of document-based table ranges generated by the query

    - nfn: FI_RANGES
      fv: Integer count of Field Index based table ranges generated by the query

    - nfn: HOST
      fv: Host name from which the query originated

    - nfn: LAST_UPDATED
      fv: Date/time of most recent update to the query (YYYYMMDD hhmmss)

    - nfn: LIFECYCLE
      fv: "One of <em>datawave.webservice.query.metric.BaseQueryMetric.Lifecycle</em>"

    - nfn: NEXT_COUNT
      fv: Number of times user requested a page of results, or invoked the /Query/{query id}/next endpoint, for the query

    - nfn: NUM_UPDATES
      fv: Integer count denoting the number of updates that occurred to the query

    - nfn: "PAGE_METRICS.[<em>n</em>]"
      fv: Metrics metadata for a single page of results, where N is an integer denoting the Nth page

    - nfn: PLAN
      fv: The final (actual) query expression to be evaluated by DataWave

    - nfn: QUERY_ID
      fv: UID generated by the system upon query creation, used in subsequent API calls

    - nfn: QUERY_TYPE
      fv: Name of the internal Java class that was employed to encapsulate the query and its state

    - nfn: CREATE_TIME
      fv: Amount of time elapsed (in ms) for the creation phase of the query

    - nfn: ELAPSED_TIME
      fv: Total amount of time elapsed (in ms) between creation and the query's current state

    - nfn: SEEK_COUNT
      fv: Number of Accumulo Iterator seeks required by the query

    - nfn: SOURCE_COUNT
      fv: Number of Accumulo Iterator sources required by the query

    - nfn: USER
      fv: User name associated with the query

    - nfn: USER_DN
      fv: User's distinguished name from client certificate

  - id: IPET
    name: Ingest Processing Error Tables
    info: |
       Set of four tables that mirror the schemas defined by PDT, GFIDX, GRIDX, and DDT respectively. The only difference
       is that these tables are intended to store Data Objects that failed to ingest due to one or more errors encountered
       during the ingest process. Rather than create redundant table layouts for these four tables, here we'll simply describe
       the normalized field name (NFN) and field value (FV) entries that DataWave uses to convey information about the error(s)
    entries:
    - row: SHARD
      cf: DT + NB + UID
      cq: "'ERROR' + NB + FV"
      val: "NULL"
      purpose: "Denotes the error category, where NFN = ERROR and FV is one of <em>datawave.ingest.data.RawDataErrorNames</em>"
      example: ""

    - row: SHARD
      cf: DT + NB + UID
      cq: "'JOB_ID' + NB + FV"
      val: "NULL"
      purpose: Identifies the job, where NFN = JOB_ID and FV is the MapReduce Job ID
      example: ""

    - row: SHARD
      cf: DT + NB + UID
      cq: "'JOB_NAME' + NB + FV"
      val: "NULL"
      purpose: Identifies the job, where NFN = JOB_NAME and FV is the MapReduce Job Name
      example: ""

    - row: SHARD
      cf: D
      cq: "DT + NB + UID + NB + 'EVENT'"
      val: DC
      purpose: Conveys the raw content of the actual data object that failed via DC, using EVENT as the DVN
      example: ""
